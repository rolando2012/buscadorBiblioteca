<!DOCTYPE html>
<html lang="{{ lang }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resultados de la Búsqueda</title>
    <link rel="stylesheet" href="../static/css/results.css" />
  </head>
  <body>
    <header class="cabecera"></header>
    <div class="contenedor">
      <aside class="izquierda">
        <div class="header">
          <img src="../static/images/libros.png" alt="iconolibro" id="libros" />
          <img
            src="../static/images/titulosinfondo.png"
            alt="ONTOFLOW"
            id="titulo"
          />
        </div>
      </aside>
      <section class="derecha">
        <div class="buscador">
          <form id="searchForm" action="/search" method="post">
            <input
              type="text"
              name="query"
              value="{{ query }}"
              placeholder="{{ '¿Qué es lo que desea buscar?' if lang == 'Español' else 'What do you want to search for?' }}"
            />
            <div class="custom-select">
              <div class="selected-option" onclick="toggleDropdown()">
                <img
                  src="../static/images/{% if lang == 'English' %}reino-unido.png{% else %}bandera.png{% endif %}"
                  alt="{{ lang }}"
                  class="flag"
                />
                <span>{{ 'English' if lang == 'English' else 'Español' }}</span>
              </div>
              <div class="options">
                <div class="option" data-value="Español">
                  <img
                    src="../static/images/bandera.png"
                    alt="Español"
                    class="flag"
                  />
                  Español
                </div>
                <div class="option" data-value="English">
                  <img
                    src="../static/images/reino-unido.png"
                    alt="English"
                    class="flag"
                  />
                  English
                </div>
              </div>
            </div>
            <input
              type="hidden"
              id="langInput"
              name="lang"
              value="{{ lang }}"
            />
            <button type="submit">
              {{ 'Buscar' if lang == 'Español' else 'Search' }}
            </button>
          </form>
        </div>
        <main class="container">
          <h2>Local</h2>
          {% if results %}
          <ul>
            {% for result in results.local %}
            <li>
              <div class="opcion" onclick="clickA(this)">
                <a href="/details/{{ result.Instancia }}?lang={{ lang }}"
                  >{{ result.Titulo }}</a
                ><br />
                <small> {{ property_labels["Instancia"]["lang"] }} </small>
                <ul class="detalles">
                  {% for info in result.MasInformacion %}
                  <li>
                    {{ (property_labels[info.split(':')[0]][lang]) ~ ':' ~
                    info.split(':')[1] }}
                  </li>
                  {% endfor %}
                  <p>...</p>
                </ul>
              </div>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p>{{ property_labels['No se encontraron resultados.'][lang] }}</p>
          {% endif %}

          <h2 id="onlineHeader">
            {{ 'En línea' if lang == 'Español' else 'Online' }}
          </h2>
          {% if results.dbpedia %}
          <ul>
            {% for result in results.dbpedia %}
            <li>
              <a href="/dbpedia_details/{{ result.title }}?lang={{ lang }}"
                >{{ result.title }}</a
              >
            </li>
            {% endfor %}
          </ul>
          {% elif offline %}
          <p>{{offline}}</p>
          {% else %}
          <p>No se encontraron resultados en DBpedia.</p>
          {% endif %}

          <div class="contCastor">
            <img
              src="../static/images/castor.png"
              alt="castorcito"
              id="castor"
            />
          </div>
        </main>
      </section>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const lang = "{{ lang }}"; // El idioma enviado desde el backend
        const langInput = document.getElementById("langInput");
        const selectedOption = document.querySelector(".selected-option span");
        const button = document.querySelector("button");
        const input = document.querySelector("input");
        const onlineHeader = document.getElementById("onlineHeader");

        // Actualizar elementos al cargar la página según el idioma
        if (lang === "Español") {
          input.setAttribute("placeholder", "¿Qué es lo que desea buscar?");
          button.textContent = "Buscar";
          onlineHeader.textContent = "En línea";
        } else {
          input.setAttribute("placeholder", "What do you want to search for?");
          button.textContent = "Search";
          onlineHeader.textContent = "Online";
        }

        // Manejador para las opciones de idioma
        document.querySelectorAll(".option").forEach((option) => {
          option.addEventListener("click", function () {
            const selectedLang = option.getAttribute("data-value");

            // Actualiza el valor del campo oculto en el formulario
            langInput.value = selectedLang;

            // Cambia el texto y el marcador de idioma según el idioma seleccionado
            selectedOption.textContent = option.textContent;
            document
              .querySelector(".selected-option img")
              .setAttribute(
                "src",
                option.querySelector("img").getAttribute("src")
              );

            // Actualizar el placeholder, el texto del botón y el encabezado al seleccionar el idioma
            if (selectedLang === "Español") {
              input.setAttribute("placeholder", "¿Qué es lo que desea buscar?");
              button.textContent = "Buscar";
              onlineHeader.textContent = "En línea";
            } else {
              input.setAttribute(
                "placeholder",
                "What do you want to search for?"
              );
              button.textContent = "Search";
              onlineHeader.textContent = "Online";
            }

            // Cierra el dropdown (modal)
            document.querySelector(".custom-select").classList.remove("open");
          });
        });
      });

      function toggleDropdown() {
        document.querySelector(".custom-select").classList.toggle("open");
      }

      document.addEventListener("click", function (event) {
        const customSelect = document.querySelector(".custom-select");
        if (!customSelect.contains(event.target)) {
          customSelect.classList.remove("open");
        }
      });

      function clickA(div) {
        const link = div.querySelector("a");
        if (link) {
          window.location.href = link.href;
        }
      }
    </script>
  </body>
</html>
